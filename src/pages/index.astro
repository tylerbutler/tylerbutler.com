---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

// Get recent articles (latest 5, non-draft)
const articles = await getCollection('articles', ({ data }) => {
  return !data.draft;
});

// Sort by date (newest first) and take first 5, then render each
const sortedArticles = articles
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 5);

// Render content for each article to get preview
const recentArticles = await Promise.all(
  sortedArticles.map(async (article) => {
    const { Content } = await article.render();
    return { ...article, RenderedContent: Content };
  })
);
---

<BaseLayout title="Tyler Butler - Personal Website" description="Personal website and blog of Tyler Butler, featuring articles on technology, programming, and more.">
  <nav class="links-nav">
    <ul class="horizontal-links">
      <li><a href="https://github.com/tylerbutler" target="_blank" rel="noopener">GitHub</a></li>
      <li><a href="mailto:tyler@tylerbutler.com">Email</a></li>
      <li><a href="/feed.xml">Feed</a></li>
      <li><a href="/articles">Archive</a></li>
    </ul>
  </nav>

  <div class="homepage-layout">
    <main class="main-content">

    {recentArticles.length > 0 && (
      <ul class="recent-articles">
        {recentArticles.map((article) => {
          const date = new Date(article.data.date);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const slug = article.data.slug || article.slug;

          return (
            <li>
              <article class="article-preview">
                <h3>
                  <a href={`/articles/${year}/${month}/${slug}`}>
                    {article.data.title}
                  </a>
                </h3>
                <time datetime={article.data.date.toISOString()}>
                  {date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
                {article.data.tags && article.data.tags.length > 0 && (
                  <div class="tags">
                    {article.data.tags.map((tag) => (
                      <span class="tag">{tag}</span>
                    ))}
                  </div>
                )}
                <div class="article-content">
                  <article.RenderedContent />
                </div>
              </article>
            </li>
          );
        })}
      </ul>
    )}

    <p>
      <a href="/articles">View All Articles</a>
    </p>
    </main>
  </div>
</BaseLayout>

<style>
  .links-nav {
    margin: 0;
    padding: 1em 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .horizontal-links {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 1.5em;
    justify-content: center;
  }

  .horizontal-links a {
    color: var(--text);
    text-decoration: none;
    font-size: 13px;
    font-family: Lato, sans-serif;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .horizontal-links a:hover {
    color: var(--accent);
  }

  .homepage-layout {
    max-width: var(--content-width);
    margin: 0;
  }

  @media (max-width: 768px) {
    .horizontal-links {
      flex-direction: column;
      gap: 0.5em;
    }
  }

  .recent-articles {
    list-style: none;
    padding: 0;
    margin: 2em 0;
  }

  .article-preview {
    margin-bottom: 1.5em;
    padding-bottom: 1em;
    border-bottom: 1px solid #f0f0f0;
  }

  .article-preview:last-child {
    border-bottom: none;
  }

  .article-preview h3 {
    margin: 0 0 0.5em 0;
    font-size: 18px;
    font-weight: 400;
  }

  .article-preview h3 a {
    color: var(--text);
    text-decoration: none;
  }

  .article-preview h3 a:hover {
    color: var(--accent);
  }

  .article-preview time {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .excerpt {
    margin: 0.5em 0;
    font-size: 13px;
    line-height: 1.6;
    color: #555;
  }

  .article-content {
    margin: 0.5em 0;
    font-size: 13px;
    line-height: 1.6;
    color: #555;
  }

  .article-content h1,
  .article-content h2,
  .article-content h3,
  .article-content h4,
  .article-content h5,
  .article-content h6 {
    color: var(--text);
    margin: 1em 0 0.5em 0;
  }

  .article-content p {
    margin: 0.5em 0;
  }

  .article-content a {
    color: var(--accent);
  }

  .article-content pre,
  .article-content code {
    background: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 12px;
  }

  .article-content blockquote {
    border-left: 3px solid #ddd;
    padding-left: 1em;
    margin: 1em 0;
    font-style: italic;
  }

  .tags {
    margin: 0.5em 0;
  }

  .tag {
    display: inline-block;
    background: #f0f0f0;
    padding: 2px 6px;
    margin-right: 6px;
    margin-bottom: 4px;
    font-size: 11px;
    color: #666;
    border-radius: 3px;
    text-transform: lowercase;
  }
</style>