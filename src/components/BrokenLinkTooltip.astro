---
// No props needed - runs client-side
---

<script>
  import { computePosition, flip, shift, offset } from "@floating-ui/dom";

  document.addEventListener("DOMContentLoaded", () => {
    // Find all broken links and add tooltip functionality
    const brokenLinks = document.querySelectorAll('a[data-broken="true"]');

    brokenLinks.forEach((link) => {
      const url =
        link.getAttribute("data-broken-url") ||
        (link as HTMLAnchorElement).href;

      // Create tooltip element
      const tooltip = document.createElement("div");
      tooltip.className = "broken-link-tooltip";
      tooltip.innerHTML = `
        <div class="tooltip-content">
          <strong>ðŸ”— Link no longer available</strong>
          <div class="tooltip-url">${url}</div>
        </div>
      `;
      tooltip.style.display = "none";
      document.body.appendChild(tooltip);

      // Show tooltip on hover
      link.addEventListener("mouseenter", async () => {
        tooltip.style.display = "block";

        // Use Floating UI to position tooltip
        const { x, y } = await computePosition(link, tooltip, {
          placement: "top",
          middleware: [offset(10), flip(), shift({ padding: 8 })],
        });

        Object.assign(tooltip.style, {
          left: `${x}px`,
          top: `${y}px`,
        });
      });

      link.addEventListener("mouseleave", () => {
        tooltip.style.display = "none";
      });
    });
  });
</script>

<style is:global>
  .broken-link-tooltip {
    position: absolute;
    padding: 12px 16px;
    background: var(--code-bg);
    color: var(--text);
    border-radius: 10px;
    font-size: 13px;
    line-height: 1.6;
    max-width: 320px;
    z-index: 10000;
    box-shadow:
      0 10px 25px rgba(0, 0, 0, 0.15),
      0 4px 10px rgba(0, 0, 0, 0.1);
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", "Lato", sans-serif;
    font-weight: 400;
    letter-spacing: 0.2px;
    border: 1px solid var(--code-border);
    pointer-events: none;
  }

  .dark .broken-link-tooltip {
    box-shadow:
      0 10px 25px rgba(0, 0, 0, 0.5),
      0 4px 10px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
  }

  .broken-link-tooltip .tooltip-content {
    text-align: center;
  }

  .broken-link-tooltip strong {
    display: block;
    margin-bottom: 6px;
    color: var(--text);
  }

  .broken-link-tooltip .tooltip-url {
    font-size: 12px;
    color: var(--text-light);
    word-break: break-all;
    opacity: 0.9;
  }

  @keyframes tooltipFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .broken-link-tooltip {
    animation: tooltipFadeIn 0.2s ease-out;
  }

  @media (max-width: 768px) {
    .broken-link-tooltip {
      max-width: calc(100vw - 48px);
    }
  }
</style>
